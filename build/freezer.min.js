/*
freezer-js v0.9.6
https://github.com/arqex/freezer
MIT: https://github.com/arqex/freezer/raw/master/LICENSE
*/
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Freezer=t()}(this,function(){"use strict";var e=new Function("return this")(),t={extend:function(e,t){for(var r in t)e[r]=t[r];return e},createNonEnumerable:function(e,t){var r={};for(var n in e)r[n]={value:e[n]};return Object.create(t||{},r)},error:function(e){var t=new Error(e);if(console)return console.error(t);throw t},each:function(e,t){var r,n,i;if(e&&e.constructor==Array)for(r=0,n=e.length;n>r;r++)t(e[r],r);else for(i=Object.keys(e),r=0,n=i.length;n>r;r++)t(e[i[r]],i[r])},addNE:function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!1,configurable:!0,writable:!0,value:t[r]})},nextTick:function(){function t(){for(;n=i.shift();)n();a=!1}function r(e){i.push(e),a||(a=!0,f())}var n,i=[],a=!1,o=!!e.postMessage&&"undefined"!=typeof Window&&e instanceof Window,s="nexttick",f=function(){return o?function(){e.postMessage(s,"*")}:function(){setTimeout(function(){c()},0)}}(),c=function(){return o?function(r){r.source===e&&r.data===s&&(r.stopPropagation(),t())}:t}();return o&&e.addEventListener("message",c,!0),r.removeListener=function(){e.removeEventListener("message",c,!0)},r}(),findPivot:function(e){if(e&&e.__){if(e.__.pivot)return e;for(var t,r=0,n=e.__.parents,i=0;!r&&i<n.length;)t=n[i],t.__.pivot&&(r=t),i++;if(r)return r;for(i=0;!r&&i<n.length;)r=this.findPivot(n[i]),i++;return r}}},r="beforeAll",n="afterAll",i=["immediate",r,n],a={on:function(e,t,r){var n=this._events[e]||[];return n.push({callback:t,once:r}),this._events[e]=n,this},once:function(e,t){return this.on(e,t,!0)},off:function(e,t){if("undefined"==typeof e)this._events={};else if("undefined"==typeof t)this._events[e]=[];else{var r,n=this._events[e]||[];for(r=n.length-1;r>=0;r--)n[r].callback===t&&n.splice(r,1)}return this},trigger:function(e){var t,a,o=[].slice.call(arguments,1),s=this._events[e]||[],f=[],c=-1!=i.indexOf(e);for(c||this.trigger.apply(this,[r,e].concat(o)),t=0;t<s.length;t++)a=s[t],a.callback?a.callback.apply(this,o):a.once=!0,a.once&&f.push(t);for(t=f.length-1;t>=0;t--)s.splice(f[t],1);return c||this.trigger.apply(this,[n,e].concat(o)),this}},o=t.createNonEnumerable(a),s=function(e){var t={};for(var r in e)t[r]={writable:!0,configurable:!0,enumerable:!1,value:e[r]};return t},f={set:function(e,t){var r=e,n=this.__.trans;if("object"!=typeof e&&(r={},r[e]=t),!n){for(var i in r)n=n||this[i]!==r[i];if(!n)return this}return this.__.notify("merge",this,r)},reset:function(e){return this.__.notify("replace",this,e)},getListener:function(){return this.__.notify("listener",this)},toJS:function(){var e;return e=this.constructor==Array?new Array(this.length):{},t.each(this,function(t,r){e[r]=t&&t.__?t.toJS():t}),e},transact:function(){return this.__.notify("transact",this)},run:function(){return this.__.notify("run",this)},now:function(){return this.__.notify("now",this)},pivot:function(){return this.__.notify("pivot",this)}},c=t.extend({push:function(e){return this.append([e])},append:function(e){return e&&e.length?this.__.notify("splice",this,[this.length,0].concat(e)):this},pop:function(){return this.length?this.__.notify("splice",this,[this.length-1,1]):this},unshift:function(e){return this.prepend([e])},prepend:function(e){return e&&e.length?this.__.notify("splice",this,[0,0].concat(e)):this},shift:function(){return this.length?this.__.notify("splice",this,[0,1]):this},splice:function(){return this.__.notify("splice",this,arguments)}},f),u=Object.create(Array.prototype,s(c)),h={Hash:Object.create(Object.prototype,s(t.extend({remove:function(e){var t=[],r=e;e.constructor!=Array&&(r=[e]);for(var n=0,i=r.length;i>n;n++)this.hasOwnProperty(r[n])&&t.push(r[n]);return t.length?this.__.notify("remove",this,t):this}},f))),List:u,arrayMethods:c},_={freeze:function(e,r,n,i){if(e&&e.__)return e;var a,o,s=this;return a=e.constructor==Array?this.createArray(e.length):Object.create(h.Hash),t.addNE(a,{__:{listener:!1,parents:[],notify:r,freezeFn:n,live:i||!1}}),t.each(e,function(e,t){o=e&&e.constructor,(o==Array||o==Object)&&(e=s.freeze(e,r,n,i)),e&&e.__&&s.addParent(e,a),a[t]=e}),n(a),a},update:function(e,r,n){return this[e]?this[e](r,n):t.error("Unknown update type: "+e)},reset:function(e,r){var n=this,i=e.__,a=r;return a.__||(a=this.freeze(r,i.notify,i.freezeFn,i.live)),a.__.listener=i.listener,a.__.parents=i.parents,this.fixChildren(a,e),t.each(a,function(t){t&&t.__&&(n.removeParent(e),n.addParent(t,a))}),a},merge:function(e,r){var n=e.__,i=n.trans,r=t.extend({},r);if(i){for(var a in r)i[a]=r[a];return e}var o,s,f,c,u=this,h=this.copyMeta(e),_=n.notify;t.each(e,function(t,i){return c=t&&t.__,c&&u.removeParent(t,e),(o=r[i])?(s=o&&o.constructor,(s==Array||s==Object)&&(o=u.freeze(o,_,n.freezeFn,n.live)),o&&o.__&&u.addParent(o,h),delete r[i],void(h[i]=o)):(c&&u.addParent(t,h),h[i]=t)});for(f in r)o=r[f],s=o&&o.constructor,(s==Array||s==Object)&&(o=u.freeze(o,_,n.freezeFn,n.live)),o&&o.__&&u.addParent(o,h),h[f]=o;return n.freezeFn(h),this.refreshParents(e,h),h},replace:function(e,t){var r=this,n=t&&t.constructor,i=e.__,a=t;(n==Array||n==Object)&&(a=r.freeze(t,i.notify,i.freezeFn,i.live),a.__.parents=i.parents,i.listener&&(a.__.listener=i.listener),this.trigger(a,"update",a,i.live)),!i.parents.length&&i.listener&&i.listener.trigger("immediate",e,a);for(var o=i.parents.length-1;o>=0;o--)this.refresh(i.parents[o],e,a);return a},remove:function(e,r){var n=e.__.trans;if(n){for(var i=r.length-1;i>=0;i--)delete n[r[i]];return e}var a,o=this,s=this.copyMeta(e);return t.each(e,function(t,n){a=t&&t.__,a&&o.removeParent(t,e),-1==r.indexOf(n)&&(a&&o.addParent(t,s),s[n]=t)}),e.__.freezeFn(s),this.refreshParents(e,s),s},splice:function(e,r){var n=e.__,i=n.trans;if(i)return i.splice.apply(i,r),e;var a,o,s=this,f=this.copyMeta(e),c=r[0],u=c+r[1];if(t.each(e,function(t,r){t&&t.__&&(s.removeParent(t,e),(c>r||r>=u)&&s.addParent(t,f)),f[r]=t}),r.length>1)for(var h=r.length-1;h>=2;h--)o=r[h],a=o&&o.constructor,(a==Array||a==Object)&&(o=this.freeze(o,n.notify,n.freezeFn,n.live)),o&&o.__&&this.addParent(o,f),r[h]=o;return Array.prototype.splice.apply(f,r),e.__.freezeFn(f),this.refreshParents(e,f),f},transact:function(e){var r,n=this,i=e.__.trans;return i?i:(r=e.constructor==Array?[]:{},t.each(e,function(e,t){r[t]=e}),e.__.trans=r,t.nextTick(function(){e.__.trans&&n.run(e)}),r)},run:function(e){var r=this,n=e.__.trans;if(!n)return e;t.each(n,function(t){t&&t.__&&r.removeParent(t,e)}),delete e.__.trans;var i=this.replace(e,n);return i},pivot:function(e){return e.__.pivot=1,this.unpivot(e),e},unpivot:function(e){t.nextTick(function(){e.__.pivot=0})},refresh:function(e,r,n){var i=this,a=e.__.trans,o=0;if(a)return t.each(a,function(t,s){o||t===r&&(a[s]=n,o=1,n&&n.__&&i.addParent(n,e))}),e;var s,f=this.copyMeta(e);t.each(e,function(t,a){t===r&&(t=n),t&&(s=t.__)&&(i.removeParent(t,e),i.addParent(t,f)),f[a]=t}),e.__.freezeFn(f),this.refreshParents(e,f)},fixChildren:function(e,r){var n=this;t.each(e,function(t){if(t&&t.__){if(-1!=t.__.parents.indexOf(e))return n.fixChildren(t);if(1==t.__.parents.length)return t.__.parents=[e];r&&n.removeParent(t,r),n.addParent(t,e)}})},copyMeta:function(e){var r;r=e.constructor==Array?this.createArray(e.length):Object.create(h.Hash);var n=e.__;return t.addNE(r,{__:{notify:n.notify,listener:n.listener,parents:n.parents.slice(0),trans:n.trans,freezeFn:n.freezeFn,pivot:n.pivot,live:n.live}}),n.pivot&&this.unpivot(r),r},refreshParents:function(e,t){var r,n=e.__;if(this.trigger(t,"update",t,n.live),n.parents.length)for(r=n.parents.length-1;r>=0;r--)this.refresh(n.parents[r],e,t);else n.listener&&n.listener.trigger("immediate",e,t)},removeParent:function(e,t){var r=e.__.parents,n=r.indexOf(t);-1!=n&&r.splice(n,1)},addParent:function(e,t){var r=e.__.parents,n=r.indexOf(t);-1==n&&(r[r.length]=t)},trigger:function(e,r,n,i){var a=e.__.listener;if(a){var o=a.ticking;if(i)return void((o||n)&&(a.ticking=0,a.trigger(r,o||n)));a.ticking=n,o||t.nextTick(function(){if(a.ticking){var e=a.ticking;a.ticking=0,a.trigger(r,e)}})}},createListener:function(e){var t=e.__.listener;return t||(t=Object.create(o,{_events:{value:{},writable:!0}}),e.__.listener=t),t},createArray:function(){return[].__proto__?function(e){var t=new Array(e);return t.__proto__=h.List,t}:function(e){var t=new Array(e),r=h.arrayMethods;for(var n in r)t[n]=r[n];return t}}()},l=function(e,r){var n,i=this,a=r&&r.mutable||!1,o=r&&r.live||o,s=[],f=0,c=function(e){var t,r=e.__;for(r.listener&&(_.trigger(e,"update",0,!0),r.parents.length||r.listener.trigger("immediate","now")),t=0;t<r.parents.length;t++)h("now",r.parents[t])},u=function(e){s.push(e),f||(f=1,t.nextTick(function(){s=[],f=0}))},h=function(e,r,n){{var i;r.__}if("listener"==e)return _.createListener(r);if("now"==e){if(s.length)for(;s.length;)i=s.shift(),c(i);else c(r);return r}var a=_.update(e,r,n);if("pivot"!=e){var o=t.findPivot(a);if(o)return u(a),o}return a},l=function(){};a||(l=function(e){Object.freeze(e)}),n=_.freeze(e,h,l,o);var p=n.getListener(),v=!1;p.on("immediate",function(e,r){if("now"==e){if(!v)return;return v=!1,i.trigger("update",n)}if(e==n)return n=r,o?i.trigger("update",r):void(v||(v=!0,t.nextTick(function(){v&&(v=!1,i.trigger("update",n))})))}),t.addNE(this,{get:function(){return n},set:function(e){var t=h("reset",n,e);t.__.listener.trigger("immediate",n,t)}}),t.addNE(this,{getData:this.get,setData:this.set}),this._events=[]};return l.prototype=t.createNonEnumerable({constructor:l},o),l});