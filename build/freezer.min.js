/*
freezer-js v0.13.0
https://github.com/arqex/freezer
MIT: https://github.com/arqex/freezer/raw/master/LICENSE
*/
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Freezer=t()}(this,function(){"use strict";function e(e){n.warn(!1,"Method "+e.name+" called on a detached node.",e.node,e.options)}var t="undefined"!=typeof t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},n={extend:function(e,t){for(var n in t)e[n]=t[n];return e},createNonEnumerable:function(e,t){var n={};for(var r in e)n[r]={value:e[r]};return Object.create(t||{},n)},error:function(e){var t=new Error(e);if(console)return console.error(t);throw t},each:function(e,t){var n,r,i;if(e&&e.constructor===Array)for(n=0,r=e.length;n<r;n++)t(e[n],n);else for(i=Object.keys(e),n=0,r=i.length;n<r;n++)t(e[i[n]],i[n])},addNE:function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!0,value:t[n]})},createNE:function(e){var t={};for(var n in e)t[n]={writable:!0,configurable:!0,enumerable:!1,value:e[n]};return t},nextTick:function(){function e(){for(o=!1;r=i.shift();)r()}function n(e){i.push(e),o||(o=!0,f())}var r,i=[],o=!1,s=!!t.postMessage&&"undefined"!=typeof Window&&t instanceof Window,a="nexttick",f=function(){return s?function(){t.postMessage(a,"*")}:function(){setTimeout(function(){c()},0)}}(),c=function(){return s?function(n){n.source===t&&n.data===a&&(n.stopPropagation(),e())}:e}();return s&&t.addEventListener("message",c,!0),n.removeListener=function(){t.removeEventListener("message",c,!0)},n}(),findPivot:function(e){if(e&&e.__){if(e.__.pivot)return e;for(var t,n=0,r=e.__.parents,i=0;!n&&i<r.length;)t=r[i],t.__.pivot&&(n=t),i++;if(n)return n;for(i=0;!n&&i<r.length;)n=this.findPivot(r[i]),i++;return n}},isLeaf:function(e,t){var n;return!e||!(n=e.constructor)||(t?n===String||n===Number||n===Boolean:n!==Object&&n!==Array)},warn:function(){var e;"undefined"!=typeof process&&"production"===process.env.NODE_ENV||arguments[0]||"undefined"==typeof console||(e=Array.prototype.slice.call(arguments,1),e[0]="Freezer.js WARNING: "+e[0],console.warn.apply(console,e))}},r={init:function(e){var t={set:function(e,t){var r=e,i=this.__.trans,o=this.constructor===Array,s="Freezer arrays only accept numeric attributes, given: ";if("object"!=typeof e){if(o&&parseInt(e)!=e)return n.warn(0,s+e),n.findPivot(this)||this;r={},r[e]=t}if(!i){for(var a in r){if(o&&parseInt(a)!=a)return n.warn(0,s+a),n.findPivot(this)||this;i=i||this[a]!==r[a]}if(!i)return n.findPivot(this)||this}var f=o?"array.set":"object.set";return this.__.store.notify("merge",this,r,f)},reset:function(e){return this.__.store.notify("replace",this,e,"object.replace")},getListener:function(){return e.createListener(this)},toJS:function(){var e;return e=this.constructor===Array?new Array(this.length):{},n.each(this,function(t,n){t&&t.__?e[n]=t.toJS():e[n]=t}),e},transact:function(){return this.__.store.notify("transact",this)},run:function(){return this.__.store.notify("run",this)},now:function(){return this.__.store.notify("now",this)},pivot:function(){return this.__.store.notify("pivot",this)}},r=n.extend({push:function(e){return this.append([e],"array.push")},append:function(e,t){return e&&e.length?this.__.store.notify("splice",this,[this.length,0].concat(e),t||"array.append"):this},pop:function(){return this.length?this.__.store.notify("splice",this,[this.length-1,1],"array.pop"):this},unshift:function(e){return this.prepend([e],"array.unshift")},prepend:function(e){return e&&e.length?this.__.store.notify("splice",this,[0,0].concat(e),"array.prepend"):this},shift:function(){return this.length?this.__.store.notify("splice",this,[0,1],"array.shift"):this},splice:function(e,t,n){return this.__.store.notify("splice",this,arguments,"array.splice")},sort:function(){var e=this.slice();return e.sort.apply(e,arguments),this.__.store.notify("replace",this,e,"array.sort")}},t),i=Object.create(Array.prototype,n.createNE(r)),o=n.createNE(n.extend({remove:function(e){var t=[],n=e;e.constructor!==Array&&(n=[e]);for(var r=0,i=n.length;r<i;r++)this.hasOwnProperty(n[r])&&t.push(n[r]);return t.length?this.__.store.notify("remove",this,t,"object.remove"):this}},t)),s=Object.create(Object.prototype,o),a=function(){return[].__proto__?function(e){var t=new Array(e);return t.__proto__=i,t}:function(e){var t=new Array(e);for(var n in r)t[n]=r[n];return t}}();this.clone=function(e){var t=e.constructor;return t===Array?a(e.length):t===Object?Object.create(s):Object.create(t.prototype,o)}}},i="beforeAll",o="afterAll",s=[i,o],a={on:function(e,t,n){var r=this._events[e]||[];return r.push({callback:t,once:n}),this._events[e]=r,this},once:function(e,t){return this.on(e,t,!0)},off:function(e,t){if("undefined"==typeof e)this._events={};else if("undefined"==typeof t)this._events[e]=[];else{var n,r=this._events[e]||[];for(n=r.length-1;n>=0;n--)r[n].callback===t&&r.splice(n,1)}return this},emit:function(e){var t,n,r,a,f=[].slice.call(arguments,1),c=this._events[e]||[],u=[],h=s.indexOf(e)!==-1;for(h||this.emit.apply(this,[i,e].concat(f)),t=0;t<c.length;t++)n=c[t],n.callback?a=n.callback.apply(this,f):n.once=!0,n.once&&u.push(t),void 0!==a&&(r=a);for(t=u.length-1;t>=0;t--)c.splice(u[t],1);return h||this.emit.apply(this,[o,e].concat(f)),r},trigger:function(){return n.warn(!1,"Method `trigger` is deprecated and will be removed from freezer in upcoming releases. Please use `emit`."),this.emit.apply(this,arguments)}},f=n.createNonEnumerable(a),c={freeze:function(e,t){if(e&&e.__)return e;var i=this,o=r.clone(e);return n.addNE(o,{__:{listener:!1,parents:[],store:t}}),n.each(e,function(e,r){n.isLeaf(e,t.freezeInstances)||(e=i.freeze(e,t)),e&&e.__&&i.addParent(e,o),o[r]=e}),t.freezeFn(o),o},merge:function(e,t){var r=e.__,i=r.trans,t=n.extend({},t);if(i){for(var o in t)i[o]=t[o];return e}var s,a,f,c=this,u=this.copyMeta(e),h=r.store;n.each(e,function(r,i){return f=r&&r.__,f&&c.removeParent(r,e),(s=t[i])?(n.isLeaf(s,h.freezeInstances)||(s=c.freeze(s,h)),s&&s.__&&c.addParent(s,u),delete t[i],void(u[i]=s)):(f&&c.addParent(r,u),u[i]=r)});for(a in t)s=t[a],n.isLeaf(s,h.freezeInstances)||(s=c.freeze(s,h)),s&&s.__&&c.addParent(s,u),u[a]=s;return r.store.freezeFn(u),this.refreshParents(e,u),u},replace:function(e,t){var r=this,i=e.__,o=t;return n.isLeaf(t,i.store.freezeInstances)||(o=r.freeze(t,i.store),o.__.parents=i.parents,o.__.updateRoot=i.updateRoot,i.listener&&(o.__.listener=i.listener)),o&&this.fixChildren(o,e),this.refreshParents(e,o),o},remove:function(e,t){var r=e.__.trans;if(r){for(var i=t.length-1;i>=0;i--)delete r[t[i]];return e}var o,s=this,a=this.copyMeta(e);return n.each(e,function(n,r){o=n&&n.__,o&&s.removeParent(n,e),t.indexOf(r)===-1&&(o&&s.addParent(n,a),a[r]=n)}),e.__.store.freezeFn(a),this.refreshParents(e,a),a},splice:function(e,t){var r=e.__,i=r.trans;if(i)return i.splice.apply(i,t),e;var o,s=this,a=this.copyMeta(e),f=t[0],c=f+t[1];if(n.each(e,function(t,n){t&&t.__&&(s.removeParent(t,e),(n<f||n>=c)&&s.addParent(t,a)),a[n]=t}),t.length>1)for(var u=t.length-1;u>=2;u--)o=t[u],n.isLeaf(o,r.store.freezeInstances)||(o=this.freeze(o,r.store)),o&&o.__&&this.addParent(o,a),t[u]=o;return Array.prototype.splice.apply(a,t),r.store.freezeFn(a),this.refreshParents(e,a),a},transact:function(e){var t,r=this,i=e.__.trans;return i?i:(t=e.constructor===Array?[]:{},n.each(e,function(e,n){t[n]=e}),e.__.trans=t,n.nextTick(function(){e.__.trans&&r.run(e)}),t)},run:function(e){var t=this,r=e.__.trans;if(!r)return e;n.each(r,function(n,r){n&&n.__&&t.removeParent(n,e)}),delete e.__.trans;var i=this.replace(e,r);return i},pivot:function(e){return e.__.pivot=1,this.unpivot(e),e},unpivot:function(e){n.nextTick(function(){e.__.pivot=0})},refresh:function(e,t,r){var i=this,o=e.__.trans,s=0;if(o)return n.each(o,function(n,a){s||n===t&&(o[a]=r,s=1,r&&r.__&&i.addParent(r,e))}),e;var a,f=this.copyMeta(e);n.each(e,function(n,o){n===t&&(n=r),n&&(a=n.__)&&(i.removeParent(n,e),i.addParent(n,f)),f[o]=n}),e.__.store.freezeFn(f),this.refreshParents(e,f)},fixChildren:function(e,t){var r=this;n.each(e,function(n){if(n&&n.__){if(r.fixChildren(n),1===n.__.parents.length)return n.__.parents=[e];t&&r.removeParent(n,t),r.addParent(n,e)}})},copyMeta:function(e){var t=r.clone(e),i=e.__;return n.addNE(t,{__:{store:i.store,updateRoot:i.updateRoot,listener:i.listener,parents:i.parents.slice(0),trans:i.trans,pivot:i.pivot}}),i.pivot&&this.unpivot(t),t},refreshParents:function(e,t){var n,r=e.__,i=r.parents.length;if(e.__.updateRoot&&e.__.updateRoot(e,t),t&&this.emit(e,"update",t,r.store.live),i)for(n=i-1;n>=0;n--)this.refresh(r.parents[n],e,t)},removeParent:function(e,t){var n=e.__.parents,r=n.indexOf(t);r!==-1&&n.splice(r,1)},addParent:function(e,t){var n=e.__.parents,r=n.indexOf(t);r===-1&&(n[n.length]=t)},emit:function(e,t,r,i){var o=e.__.listener;if(o){var s=o.ticking;if(i)return void((s||r)&&(o.ticking=0,o.emit(t,s||r,e)));o.ticking=r,o.prevState||(o.prevState=e),s||n.nextTick(function(){if(o.ticking){var n=o.ticking;o.prevState;o.ticking=0,o.prevState=0,o.emit(t,n,e)}})}},createListener:function(e){var t=e.__.listener;return t||(t=Object.create(f,{_events:{value:{},writable:!0}}),e.__.listener=t),t}};r.init(c);var u=function(t,r){var i,o,s=this,a=r||{},f={live:a.live||!1,freezeInstances:a.freezeInstances||!1},u=[],h=0,p=function(e){var t,n=e.__;if(n.listener){var r=n.listener.prevState||e;n.listener.prevState=0,c.emit(r,"update",e,!0)}for(t=0;t<n.parents.length;t++)n.store.notify("now",n.parents[t])},_=function(e){u.push(e),h||(h=1,n.nextTick(function(){u=[],h=0}))};f.notify=function(t,r,i,s){if(s&&(o&&!o.onStore&&e(o),o={name:s,node:r,options:i,onStore:!1}),"now"===t){if(u.length)for(;u.length;)p(u.shift());else p(r);return r}var a=c[t](r,i);if("pivot"!==t){var f=n.findPivot(a);if(f)return _(a),f}return a},f.freezeFn=a.mutable===!0?function(){}:function(e){Object.freeze(e)},i=c.freeze(t,f),i.__.updateRoot=function(t,n){t===i?(i=n,o&&(o.onStore=!0)):o&&setTimeout(function(){o.onStore||e(o)})};var l=i.getListener(),v={};n.each(["on","off","once","emit","trigger"],function(e){var t={};t[e]=l[e].bind(l),n.addNE(s,t),n.addNE(v,t)}),n.addNE(this,{get:function(){return i},set:function(e){i.reset(e)},getEventHub:function(){return v}}),n.addNE(this,{getData:this.get,setData:this.set})};return u});