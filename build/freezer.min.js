/*
freezer-js v0.11.0
https://github.com/arqex/freezer
MIT: https://github.com/arqex/freezer/raw/master/LICENSE
*/
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Freezer=e()}(this,function(){"use strict";var t=new Function("return this")(),e={extend:function(t,e){for(var n in e)t[n]=e[n];return t},createNonEnumerable:function(t,e){var n={};for(var r in t)n[r]={value:t[r]};return Object.create(e||{},n)},error:function(t){var e=new Error(t);if(console)return console.error(e);throw e},each:function(t,e){var n,r,i;if(t&&t.constructor==Array)for(n=0,r=t.length;r>n;n++)e(t[n],n);else for(i=Object.keys(t),n=0,r=i.length;r>n;n++)e(t[i[n]],i[n])},addNE:function(t,e){for(var n in e)Object.defineProperty(t,n,{enumerable:!1,configurable:!0,writable:!0,value:e[n]})},createNE:function(t){var e={};for(var n in t)e[n]={writable:!0,configurable:!0,enumerable:!1,value:t[n]};return e},nextTick:function(){function e(){for(;r=i.shift();)r();o=!1}function n(t){i.push(t),o||(o=!0,f())}var r,i=[],o=!1,s=!!t.postMessage&&"undefined"!=typeof Window&&t instanceof Window,a="nexttick",f=function(){return s?function(){t.postMessage(a,"*")}:function(){setTimeout(function(){c()},0)}}(),c=function(){return s?function(n){n.source===t&&n.data===a&&(n.stopPropagation(),e())}:e}();return s&&t.addEventListener("message",c,!0),n.removeListener=function(){t.removeEventListener("message",c,!0)},n}(),findPivot:function(t){if(t&&t.__){if(t.__.pivot)return t;for(var e,n=0,r=t.__.parents,i=0;!n&&i<r.length;)e=r[i],e.__.pivot&&(n=e),i++;if(n)return n;for(i=0;!n&&i<r.length;)n=this.findPivot(r[i]),i++;return n}},isLeaf:function(t,e){var n;return!t||!(n=t.constructor)||(e?n===String||n===Number||n===Boolean:n!=Object&&n!=Array)}},n={init:function(t){var n={set:function(t,n){var r=t,i=this.__.trans;if("object"!=typeof t&&(r={},r[t]=n),!i){for(var o in r)i=i||this[o]!==r[o];if(!i)return e.findPivot(this)||this}return this.__.store.notify("merge",this,r)},reset:function(t){return this.__.store.notify("replace",this,t)},getListener:function(){return t.createListener(this)},toJS:function(){var t;return t=this.constructor==Array?new Array(this.length):{},e.each(this,function(e,n){e&&e.__?t[n]=e.toJS():t[n]=e}),t},transact:function(){return this.__.store.notify("transact",this)},run:function(){return this.__.store.notify("run",this)},now:function(){return this.__.store.notify("now",this)},pivot:function(){return this.__.store.notify("pivot",this)}},r=e.extend({push:function(t){return this.append([t])},append:function(t){return t&&t.length?this.__.store.notify("splice",this,[this.length,0].concat(t)):this},pop:function(){return this.length?this.__.store.notify("splice",this,[this.length-1,1]):this},unshift:function(t){return this.prepend([t])},prepend:function(t){return t&&t.length?this.__.store.notify("splice",this,[0,0].concat(t)):this},shift:function(){return this.length?this.__.store.notify("splice",this,[0,1]):this},splice:function(t,e,n){return this.__.store.notify("splice",this,arguments)}},n),i=Object.create(Array.prototype,e.createNE(r)),o=e.createNE(e.extend({remove:function(t){var e=[],n=t;t.constructor!=Array&&(n=[t]);for(var r=0,i=n.length;i>r;r++)this.hasOwnProperty(n[r])&&e.push(n[r]);return e.length?this.__.store.notify("remove",this,e):this}},n)),s=Object.create(Object.prototype,o),a=function(){return[].__proto__?function(t){var e=new Array(t);return e.__proto__=i,e}:function(t){var e=new Array(t);for(var n in r)e[n]=r[n];return e}}();this.clone=function(t){var e=t.constructor;return e==Array?a(t.length):e===Object?Object.create(s):Object.create(e.prototype,o)}}},r="beforeAll",i="afterAll",o=[r,i],s={on:function(t,e,n){var r=this._events[t]||[];return r.push({callback:e,once:n}),this._events[t]=r,this},once:function(t,e){return this.on(t,e,!0)},off:function(t,e){if("undefined"==typeof t)this._events={};else if("undefined"==typeof e)this._events[t]=[];else{var n,r=this._events[t]||[];for(n=r.length-1;n>=0;n--)r[n].callback===e&&r.splice(n,1)}return this},trigger:function(t){var e,n,s,a,f=[].slice.call(arguments,1),c=this._events[t]||[],u=[],h=-1!=o.indexOf(t);for(h||this.trigger.apply(this,[r,t].concat(f)),e=0;e<c.length;e++)n=c[e],n.callback?a=n.callback.apply(this,f):n.once=!0,n.once&&u.push(e),void 0!==a&&(s=a);for(e=u.length-1;e>=0;e--)c.splice(u[e],1);return h||this.trigger.apply(this,[i,t].concat(f)),s}},a=e.createNonEnumerable(s),f={freeze:function(t,r){if(t&&t.__)return t;var i=this,o=n.clone(t);return e.addNE(o,{__:{listener:!1,parents:[],store:r}}),e.each(t,function(t,n){e.isLeaf(t,r.freezeInstances)||(t=i.freeze(t,r)),t&&t.__&&i.addParent(t,o),o[n]=t}),r.freezeFn(o),o},merge:function(t,n){var r=t.__,i=r.trans,n=e.extend({},n);if(i){for(var o in n)i[o]=n[o];return t}var s,a,f,c=this,u=this.copyMeta(t),h=r.store;e.each(t,function(r,i){return f=r&&r.__,f&&c.removeParent(r,t),(s=n[i])?(e.isLeaf(s,h.freezeInstances)||(s=c.freeze(s,h)),s&&s.__&&c.addParent(s,u),delete n[i],void(u[i]=s)):(f&&c.addParent(r,u),u[i]=r)});for(a in n)s=n[a],e.isLeaf(s,h.freezeInstances)||(s=c.freeze(s,h)),s&&s.__&&c.addParent(s,u),u[a]=s;return r.store.freezeFn(u),this.refreshParents(t,u),u},replace:function(t,n){var r=this,i=t.__,o=n;return e.isLeaf(n,i.store.freezeInstances)||(o=r.freeze(n,i.store),o.__.parents=i.parents,o.__.updateRoot=i.updateRoot,i.listener&&(o.__.listener=i.listener)),o&&this.fixChildren(o,t),this.refreshParents(t,o),o},remove:function(t,n){var r=t.__.trans;if(r){for(var i=n.length-1;i>=0;i--)delete r[n[i]];return t}var o,s=this,a=this.copyMeta(t);return e.each(t,function(e,r){o=e&&e.__,o&&s.removeParent(e,t),-1==n.indexOf(r)&&(o&&s.addParent(e,a),a[r]=e)}),t.__.store.freezeFn(a),this.refreshParents(t,a),a},splice:function(t,n){var r=t.__,i=r.trans;if(i)return i.splice.apply(i,n),t;var o,s=this,a=this.copyMeta(t),f=n[0],c=f+n[1];if(e.each(t,function(e,n){e&&e.__&&(s.removeParent(e,t),(f>n||n>=c)&&s.addParent(e,a)),a[n]=e}),n.length>1)for(var u=n.length-1;u>=2;u--)o=n[u],e.isLeaf(o,r.store.freezeInstances)||(o=this.freeze(o,r.store)),o&&o.__&&this.addParent(o,a),n[u]=o;return Array.prototype.splice.apply(a,n),r.store.freezeFn(a),this.refreshParents(t,a),a},transact:function(t){var n,r=this,i=t.__.trans;return i?i:(n=t.constructor==Array?[]:{},e.each(t,function(t,e){n[e]=t}),t.__.trans=n,e.nextTick(function(){t.__.trans&&r.run(t)}),n)},run:function(t){var n=this,r=t.__.trans;if(!r)return t;e.each(r,function(e,r){e&&e.__&&n.removeParent(e,t)}),delete t.__.trans;var i=this.replace(t,r);return i},pivot:function(t){return t.__.pivot=1,this.unpivot(t),t},unpivot:function(t){e.nextTick(function(){t.__.pivot=0})},refresh:function(t,n,r){var i=this,o=t.__.trans,s=0;if(o)return e.each(o,function(e,a){s||e===n&&(o[a]=r,s=1,r&&r.__&&i.addParent(r,t))}),t;var a,f=this.copyMeta(t);e.each(t,function(e,o){e===n&&(e=r),e&&(a=e.__)&&(i.removeParent(e,t),i.addParent(e,f)),f[o]=e}),t.__.store.freezeFn(f),this.refreshParents(t,f)},fixChildren:function(t,n){var r=this;e.each(t,function(e){if(e&&e.__){if(-1!=e.__.parents.indexOf(t))return r.fixChildren(e);if(1==e.__.parents.length)return e.__.parents=[t];n&&r.removeParent(e,n),r.addParent(e,t)}})},copyMeta:function(t){var r=n.clone(t),i=t.__;return e.addNE(r,{__:{store:i.store,updateRoot:i.updateRoot,listener:i.listener,parents:i.parents.slice(0),trans:i.trans,pivot:i.pivot}}),i.pivot&&this.unpivot(r),r},refreshParents:function(t,e){var n,r=t.__,i=r.parents.length;if(t.__.updateRoot&&t.__.updateRoot(t,e),e&&this.trigger(e,"update",e,r.store.live),i)for(n=i-1;n>=0;n--)this.refresh(r.parents[n],t,e)},removeParent:function(t,e){var n=t.__.parents,r=n.indexOf(e);-1!=r&&n.splice(r,1)},addParent:function(t,e){var n=t.__.parents,r=n.indexOf(e);-1==r&&(n[n.length]=e)},trigger:function(t,n,r,i){var o=t.__.listener;if(o){var s=o.ticking;if(i)return void((s||r)&&(o.ticking=0,o.trigger(n,s||r)));o.ticking=r,s||e.nextTick(function(){if(o.ticking){var t=o.ticking;o.ticking=0,o.trigger(n,t)}})}},createListener:function(t){var e=t.__.listener;return e||(e=Object.create(a,{_events:{value:{},writable:!0}}),t.__.listener=e),e}};n.init(f);var c=function(t,n){var r,i=this,o=n||{},s={live:o.live||!1,freezeInstances:o.freezeInstances||!1},a=[],c=0,u=function(t){var e,n=t.__;for(n.listener&&f.trigger(t,"update",0,!0),e=0;e<n.parents.length;e++)n.store.notify("now",n.parents[e])},h=function(t){a.push(t),c||(c=1,e.nextTick(function(){a=[],c=0}))};s.notify=function(t,n,r){if("now"==t){if(a.length)for(;a.length;)u(a.shift());else u(n);return n}var i=f[t](n,r);if("pivot"!=t){var o=e.findPivot(i);if(o)return h(i),o}return i},s.freezeFn=o.mutable===!0?function(){}:function(t){Object.freeze(t)},r=f.freeze(t,s),r.__.updateRoot=function(t,e){t===r&&(r=e)};var _=r.getListener(),p={};e.each(["on","off","once","trigger"],function(t){var n={};n[t]=_[t].bind(_),e.addNE(i,n),e.addNE(p,n)}),e.addNE(this,{get:function(){return r},set:function(t){r.reset(t)},getEventHub:function(){return p}}),e.addNE(this,{getData:this.get,setData:this.set})};return c});