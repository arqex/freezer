/*
freezer-js v0.9.2
https://github.com/arqex/freezer
MIT: https://github.com/arqex/freezer/raw/master/LICENSE
*/
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Freezer=e()}(this,function(){"use strict";var t=new Function("return this")(),e={extend:function(t,e){for(var r in e)t[r]=e[r];return t},createNonEnumerable:function(t,e){var r={};for(var n in t)r[n]={value:t[n]};return Object.create(e||{},r)},error:function(t){var e=new Error(t);if(console)return console.error(e);throw e},each:function(t,e){var r,n,i;if(t&&t.constructor==Array)for(r=0,n=t.length;n>r;r++)e(t[r],r);else for(i=Object.keys(t),r=0,n=i.length;n>r;r++)e(t[i[r]],i[r])},addNE:function(t,e){for(var r in e)Object.defineProperty(t,r,{enumerable:!1,configurable:!0,writable:!0,value:e[r]})},nextTick:function(){function e(){for(;n=i.shift();)n();a=!1}function r(t){i.push(t),a||(a=!0,f())}var n,i=[],a=!1,s=!!t.postMessage,o="nexttick",f=function(){return s?function(){t.postMessage(o,"*")}:function(){setTimeout(function(){c()},0)}}(),c=function(){return s?function(r){r.source===t&&r.data===o&&(r.stopPropagation(),e())}:e}();return s&&t.addEventListener("message",c,!0),r.removeListener=function(){t.removeEventListener("message",c,!0)},r}(),findPivot:function(t){if(t&&t.__){if(t.__.pivot)return t;for(var e,r=0,n=t.__.parents,i=0;!r&&i<n.length;)e=n[i],e.__.pivot&&(r=e),i++;if(r)return r;for(i=0;!r&&i<n.length;)r=this.findPivot(n[i]),i++;return r}}},r="beforeAll",n="afterAll",i=["immediate",r,n],a={on:function(t,e,r){var n=this._events[t]||[];return n.push({callback:e,once:r}),this._events[t]=n,this},once:function(t,e){return this.on(t,e,!0)},off:function(t,e){if("undefined"==typeof t)this._events={};else if("undefined"==typeof e)this._events[t]=[];else{var r,n=this._events[t]||[];for(r=n.length-1;r>=0;r--)n[r].callback===e&&n.splice(r,1)}return this},trigger:function(t){var e,a,s=[].slice.call(arguments,1),o=this._events[t]||[],f=[],c=-1!=i.indexOf(t);for(c||this.trigger.apply(this,[r,t].concat(s)),e=0;e<o.length;e++)a=o[e],a.callback?a.callback.apply(this,s):a.once=!0,a.once&&f.push(e);for(e=f.length-1;e>=0;e--)o.splice(f[e],1);return c||this.trigger.apply(this,[n,t].concat(s)),this}},s=e.createNonEnumerable(a),o=function(t){var e={};for(var r in t)e[r]={writable:!0,configurable:!0,enumerable:!1,value:t[r]};return e},f={set:function(t,e){var r=t,n=this.__.trans,i=typeof t;if(("string"==i||"number"==i)&&(r={},r[t]=e),!n){for(var a in r)n=n||this[a]!=r[a];if(!n)return this}return this.__.notify("merge",this,r)},reset:function(t){return this.__.notify("replace",this,t)},getListener:function(){return this.__.notify("listener",this)},toJS:function(){var t;return t=this.constructor==Array?new Array(this.length):{},e.each(this,function(e,r){t[r]=e&&e.__?e.toJS():e}),t},transact:function(){return this.__.notify("transact",this)},run:function(){return this.__.notify("run",this)},now:function(){return this.__.notify("now",this)},pivot:function(){return this.__.notify("pivot",this)}},c=e.extend({push:function(t){return this.append([t])},append:function(t){return t&&t.length?this.__.notify("splice",this,[this.length,0].concat(t)):this},pop:function(){return this.length?this.__.notify("splice",this,[this.length-1,1]):this},unshift:function(t){return this.prepend([t])},prepend:function(t){return t&&t.length?this.__.notify("splice",this,[0,0].concat(t)):this},shift:function(){return this.length?this.__.notify("splice",this,[0,1]):this},splice:function(){return this.__.notify("splice",this,arguments)}},f),u=Object.create(Array.prototype,o(c)),h={Hash:Object.create(Object.prototype,o(e.extend({remove:function(t){var e=[],r=t;t.constructor!=Array&&(r=[t]);for(var n=0,i=r.length;i>n;n++)this.hasOwnProperty(r[n])&&e.push(r[n]);return e.length?this.__.notify("remove",this,e):this}},f))),List:u,arrayMethods:c},_={freeze:function(t,r,n,i){if(t&&t.__)return t;var a,s,o=this;return a=t.constructor==Array?this.createArray(t.length):Object.create(h.Hash),e.addNE(a,{__:{listener:!1,parents:[],notify:r,dirty:!1,freezeFn:n,live:i||!1}}),e.each(t,function(t,e){s=t&&t.constructor,(s==Array||s==Object)&&(t=o.freeze(t,r,n,i)),t&&t.__&&o.addParent(t,a),a[e]=t}),n(a),a},update:function(t,r,n){return this[t]?this[t](r,n):e.error("Unknown update type: "+t)},reset:function(t,r){var n=this,i=t.__,a=r;return a.__||(a=this.freeze(r,i.notify,i.freezeFn,i.live)),a.__.listener=i.listener,a.__.parents=i.parents,this.fixChildren(a,t),e.each(a,function(e){e&&e.__&&(n.removeParent(t),n.addParent(e,a))}),a},merge:function(t,r){var n=t.__,i=n.trans,r=e.extend({},r);if(i){for(var a in r)i[a]=r[a];return t}var s,o,f,c,u=this,h=this.copyMeta(t),_=n.notify;e.each(t,function(e,i){return c=e&&e.__,c&&u.removeParent(e,t),(s=r[i])?(o=s&&s.constructor,(o==Array||o==Object)&&(s=u.freeze(s,_,n.freezeFn,n.live)),s&&s.__&&u.addParent(s,h),delete r[i],void(h[i]=s)):(c&&u.addParent(e,h),h[i]=e)});for(f in r)s=r[f],o=s&&s.constructor,(o==Array||o==Object)&&(s=u.freeze(s,_,n.freezeFn,n.live)),s&&s.__&&u.addParent(s,h),h[f]=s;return n.freezeFn(h),this.refreshParents(t,h),h},replace:function(t,e){var r=this,n=e&&e.constructor,i=t.__,a=e;(n==Array||n==Object)&&(a=r.freeze(e,i.notify,i.freezeFn,i.live),a.__.parents=i.parents,i.listener&&(a.__.listener=i.listener),this.trigger(a,"update",a,i.live)),!i.parents.length&&i.listener&&i.listener.trigger("immediate",t,a);for(var s=i.parents.length-1;s>=0;s--)0==s?this.refresh(i.parents[s],t,a,!1):this.markDirty(i.parents[s],[t,a]);return a},remove:function(t,r){var n=t.__.trans;if(n){for(var i=r.length-1;i>=0;i--)delete n[r[i]];return t}var a,s=this,o=this.copyMeta(t);return e.each(t,function(e,n){a=e&&e.__,a&&s.removeParent(e,t),-1==r.indexOf(n)&&(a&&s.addParent(e,o),o[n]=e)}),t.__.freezeFn(o),this.refreshParents(t,o),o},splice:function(t,r){var n=t.__,i=n.trans;if(i)return i.splice.apply(i,r),t;var a,s,o=this,f=this.copyMeta(t),c=r[0],u=c+r[1];if(e.each(t,function(e,r){e&&e.__&&(o.removeParent(e,t),(c>r||r>=u)&&o.addParent(e,f)),f[r]=e}),r.length>1)for(var h=r.length-1;h>=2;h--)s=r[h],a=s&&s.constructor,(a==Array||a==Object)&&(s=this.freeze(s,n.notify,n.freezeFn,n.live)),s&&s.__&&this.addParent(s,f),r[h]=s;return Array.prototype.splice.apply(f,r),t.__.freezeFn(f),this.refreshParents(t,f),f},transact:function(t){var r,n=this,i=t.__.trans;return i?i:(r=t.constructor==Array?[]:{},e.each(t,function(t,e){r[e]=t}),t.__.trans=r,e.nextTick(function(){t.__.trans&&n.run(t)}),r)},run:function(t){var r=this,n=t.__.trans;if(!n)return t;e.each(n,function(e){e&&e.__&&r.removeParent(e,t)}),delete t.__.trans;var i=this.replace(t,n);return i},pivot:function(t){return t.__.pivot=1,this.unpivot(t),t},unpivot:function(t){e.nextTick(function(){t.__.pivot=0})},refresh:function(t,r,n,i){var a=this,s=t.__.trans,o=0;if(s)return e.each(s,function(e,i){o||e===r&&(s[i]=n,o=1,n&&n.__&&a.addParent(n,t))}),t;var f,c,u,h=this.copyMeta(t),_=t.__.dirty;return _&&(f=_[0],c=_[1]),e.each(t,function(e,i){e===r?e=n:e===f&&(e=c),e&&(u=e.__)&&(!u.trans&&u.dirty&&(e=a.refresh(e,u.dirty[0],u.dirty[1],!0)),a.removeParent(e,t),a.addParent(e,h)),h[i]=e}),t.__.freezeFn(h),_&&(t.__.dirty=!1,this.trigger(h,"update",h,h.__.live)),i?h:void this.refreshParents(t,h)},fixChildren:function(t,r){var n=this;e.each(t,function(e){if(e&&e.__){if(-1!=e.__.parents.indexOf(t))return n.fixChildren(e);if(1==e.__.parents.length)return e.__.parents=[t];r&&n.removeParent(e,r),n.addParent(e,t)}})},copyMeta:function(t){var r;r=t.constructor==Array?this.createArray(t.length):Object.create(h.Hash);var n=t.__;return e.addNE(r,{__:{notify:n.notify,listener:n.listener,parents:n.parents.slice(0),trans:n.trans,dirty:!1,freezeFn:n.freezeFn,pivot:n.pivot,live:n.live}}),n.pivot&&this.unpivot(r),r},refreshParents:function(t,e){var r,n=t.__;if(this.trigger(e,"update",e,n.live),n.parents.length)for(r=n.parents.length-1;r>=0;r--)0==r?this.refresh(n.parents[r],t,e,!1):this.markDirty(n.parents[r],[t,e]);else n.listener&&n.listener.trigger("immediate",t,e)},markDirty:function(t,e){var r,n=t.__;for(n.dirty=e,n.trans&&this.refresh(t,e[0],e[1]),r=n.parents.length-1;r>=0;r--)this.markDirty(n.parents[r],e)},removeParent:function(t,e){var r=t.__.parents,n=r.indexOf(e);-1!=n&&r.splice(n,1)},addParent:function(t,e){var r=t.__.parents,n=r.indexOf(e);-1==n&&(r[r.length]=e)},trigger:function(t,r,n,i){var a=t.__.listener;if(a){var s=a.ticking;if(i)return void((s||n)&&(a.ticking=0,a.trigger(r,s||n)));a.ticking=n,s||e.nextTick(function(){if(a.ticking){var t=a.ticking;a.ticking=0,a.trigger(r,t)}})}},createListener:function(t){var e=t.__.listener;return e||(e=Object.create(s,{_events:{value:{},writable:!0}}),t.__.listener=e),e},createArray:function(){return[].__proto__?function(t){var e=new Array(t);return e.__proto__=h.List,e}:function(t){var e=new Array(t),r=h.arrayMethods;for(var n in r)e[n]=r[n];return e}}()},l=function(t,r){var n,i=this,a=r&&r.mutable||!1,s=r&&r.live||s,o=[],f=0,c=function(t){var e,r=t.__;for(r.listener&&(_.trigger(t,"update",0,!0),r.parents.length||r.listener.trigger("immediate","now")),e=0;e<r.parents.length;e++)h("now",r.parents[e])},u=function(t){o.push(t),f||(f=1,e.nextTick(function(){o=[],f=0}))},h=function(t,r,n){{var i;r.__}if("listener"==t)return _.createListener(r);if("now"==t){if(o.length)for(;o.length;)i=o.shift(),c(i);else c(r);return r}var a=_.update(t,r,n);if("pivot"!=t){var s=e.findPivot(a);if(s)return u(a),s}return a},l=function(){};a||(l=function(t){Object.freeze(t)}),n=_.freeze(t,h,l,s);var p=n.getListener(),v=!1;p.on("immediate",function(t,r){if("now"==t){if(!v)return;return v=!1,i.trigger("update",n)}if(t==n)return n=r,s?i.trigger("update",r):void(v||(v=!0,e.nextTick(function(){v&&(v=!1,i.trigger("update",n))})))}),e.addNE(this,{get:function(){return n},set:function(t){var e=h("reset",n,t);e.__.listener.trigger("immediate",n,e)}}),e.addNE(this,{getData:this.get,setData:this.set}),this._events=[]};return l.prototype=e.createNonEnumerable({constructor:l},s),l});