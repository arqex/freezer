/*
freezer-js v0.5.2
https://github.com/arqex/freezer
MIT: https://github.com/arqex/freezer/raw/master/LICENSE
*/
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Freezer=t()}(this,function(){"use strict";var e=new Function("return this")(),t={extend:function(e,t){for(var r in t)e[r]=t[r];return e},createNonEnumerable:function(e,t){var r={};for(var n in e)r[n]={value:e[n]};return Object.create(t||{},r)},error:function(e){var t=new Error(e);if(console)return console.error(t);throw t},each:function(e,t){var r,n,i;if(e&&e.constructor==Array)for(r=0,n=e.length;n>r;r++)t(e[r],r);else for(i=Object.keys(e),r=0,n=i.length;n>r;r++)t(e[i[r]],i[r])},addNE:function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!1,configurable:!0,writable:!0,value:t[r]})},nextTick:function(){function t(){for(;n=i.shift();)n();s=!1}function r(e){i.push(e),s||(s=!0,c())}var n,i=[],s=!1,a=!!e.postMessage,o="nexttick",c=function(){return a?function(){e.postMessage(o,"*")}:function(){setTimeout(function(){f()},0)}}(),f=function(){return a?function(r){r.source===e&&r.data===o&&(r.stopPropagation(),t())}:t}();return a&&e.addEventListener("message",f,!0),r.removeListener=function(){e.removeEventListener("message",f,!0)},r}()},r={on:function(e,t,r){var n=this._events[e]||[];return n.push({callback:t,once:r}),this._events[e]=n,this},once:function(e,t){this.on(e,t,!0)},off:function(e,t){if("undefined"==typeof e)this._events={};else if("undefined"==typeof t)this._events[e]=[];else{var r,n=this._events[e]||[];for(r=n.length-1;r>=0;r--)n[r]===t&&n.splice(r,1)}return this},trigger:function(e){var t,r,n=[].slice.call(arguments,1),i=this._events[e]||[],s=[];for(t=0;t<i.length;t++)r=i[t],r.callback?r.callback.apply(null,n):r.once=!0,r.once&&s.push(t);for(t=s.length-1;t>=0;t--)i.splice(s[t],1);return this}},n=t.createNonEnumerable(r),i=function(e){var t={};for(var r in e)t[r]={writable:!0,configurable:!0,enumerable:!1,value:e[r]};return t},s={set:function(e,t){var r=e,n=this.__.trans;if("undefined"!=typeof t&&(r={},r[e]=t),!n){for(var i in r)n=n||this[i]!=r[i];if(!n)return this}return this.__.notify("merge",this,r)},reset:function(e){return this.__.notify("replace",this,e)},getListener:function(){return this.__.notify("listener",this)},toJS:function(){var e;return e=this.constructor==Array?new Array(this.length):{},t.each(this,function(t,r){e[r]=t&&t.__?t.toJS():t}),e},transact:function(){return this.__.notify("transact",this)},run:function(){return this.__.notify("run",this)}},a=t.extend({push:function(e){return this.append([e])},append:function(e){return e&&e.length?this.__.notify("splice",this,[this.length,0].concat(e)):this},pop:function(){return this.length?this.__.notify("splice",this,[this.length-1,1]):this},unshift:function(e){return this.prepend([e])},prepend:function(e){return e&&e.length?this.__.notify("splice",this,[0,0].concat(e)):this},shift:function(){return this.length?this.__.notify("splice",this,[0,1]):this},splice:function(){return this.__.notify("splice",this,arguments)}},s),o=Object.create(Array.prototype,i(a)),c={Hash:Object.create(Object.prototype,i(t.extend({remove:function(e){var t=[],r=e;e.constructor!=Array&&(r=[e]);for(var n=0,i=r.length;i>n;n++)this.hasOwnProperty(r[n])&&t.push(r[n]);return t.length?this.__.notify("remove",this,t):this}},s))),List:o,arrayMethods:a},f={freeze:function(e,r,n){if(e&&e.__)return e;var i,s,a=this;return i=e.constructor==Array?this.createArray(e.length):Object.create(c.Hash),t.addNE(i,{__:{listener:!1,parents:[],notify:r,dirty:!1,freezeFn:n}}),t.each(e,function(e,t){s=e&&e.constructor,(s==Array||s==Object)&&(e=a.freeze(e,r,n)),e&&e.__&&a.addParent(e,i),i[t]=e}),n(i),i},update:function(e,r,n){return this[e]?this[e](r,n):t.error("Unknown update type: "+e)},reset:function(e,r){var n,i=this;return r&&r.__?(n=r,n.__.listener=r.__.listener,n.__.parents=[],this.fixChildren(n,e),t.each(n,function(t){t&&t.__&&(i.removeParent(e),i.addParent(t,n))})):n=this.freeze(e,e.__.notify,e.__.freezeFn),n},merge:function(e,r){var n=e.__.trans,r=t.extend({},r);if(n){for(var i in r)n[i]=r[i];return e}var s,a,o,c,f=this,u=this.copyMeta(e),h=e.__.notify;t.each(e,function(t,n){return c=t&&t.__,c&&f.removeParent(t,e),(s=r[n])?(a=s&&s.constructor,(a==Array||a==Object)&&(s=f.freeze(s,h,e.__.freezeFn)),s&&s.__&&f.addParent(s,u),delete r[n],void(u[n]=s)):(c&&f.addParent(t,u),u[n]=t)});for(o in r)s=r[o],a=s&&s.constructor,(a==Array||a==Object)&&(s=f.freeze(s,h,e.__.freezeFn)),s&&s.__&&f.addParent(s,u),u[o]=s;return e.__.freezeFn(u),this.refreshParents(e,u),u},replace:function(e,t){var r=this,n=t&&t.constructor,i=e.__,s=t;(n==Array||n==Object)&&(s=r.freeze(t,i.notify,i.freezeFn),s.__.parents=i.parents,i.listener&&(s.__.listener=e.__.listener),s.__.listener&&this.trigger(s,"update",s)),!i.parents.length&&i.listener&&i.listener.trigger("immediate",e,s);for(var a=i.parents.length-1;a>=0;a--)0==a?this.refresh(i.parents[a],e,s,!1):this.markDirty(i.parents[a],[e,s]);return s},remove:function(e,r){var n=e.__.trans;if(n){for(var i=r.length-1;i>=0;i--)delete n[r[i]];return e}var s,a=this,o=this.copyMeta(e);return t.each(e,function(t,n){s=t&&t.__,s&&a.removeParent(t,e),-1==r.indexOf(n)&&(s&&a.addParent(t,o),o[n]=t)}),e.__.freezeFn(o),this.refreshParents(e,o),o},splice:function(e,r){var n=e.__.trans;if(n)return n.splice.apply(n,r),e;var i,s,a=this,o=this.copyMeta(e),c=r[0],f=c+r[1],u=e.__;if(t.each(e,function(t,r){t&&t.__&&(a.removeParent(t,e),(c>r||r>=f)&&a.addParent(t,o)),o[r]=t}),r.length>1)for(var h=r.length-1;h>=2;h--)s=r[h],i=s&&s.constructor,(i==Array||i==Object)&&(s=this.freeze(s,u.notify,u.freezeFn)),s&&s.__&&this.addParent(s,o),r[h]=s;return Array.prototype.splice.apply(o,r),e.__.freezeFn(o),this.refreshParents(e,o),o},transact:function(e){var r,n=this,i=e.__.trans;return i?i:(r=e.constructor==Array?[]:{},t.each(e,function(e,t){r[t]=e}),e.__.trans=r,t.nextTick(function(){e.__.trans&&n.run(e)}),r)},run:function(e){var r=this,n=e.__.trans;if(!n)return e;t.each(n,function(t){t&&t.__&&r.removeParent(t,e)}),delete e.__.trans;var i=this.replace(e,n);return i},refresh:function(e,r,n,i){var s=this,a=e.__.trans,o=0;if(a)return t.each(a,function(t,i){o||t===r&&(a[i]=n,o=1,n&&n.__&&s.addParent(n,e))}),e;var c,f,u,h=this.copyMeta(e),_=e.__.dirty;return _&&(c=_[0],f=_[1]),t.each(e,function(t,i){t===r?t=n:t===c&&(t=f),t&&(u=t.__)&&(!u.trans&&u.dirty&&(t=s.refresh(t,u.dirty[0],u.dirty[1],!0)),s.removeParent(t,e),s.addParent(t,h)),h[i]=t}),e.__.freezeFn(h),e.__.dirty=!1,i?h:void this.refreshParents(e,h)},fixChildren:function(e,r){var n=this;t.each(e,function(t){if(t&&t.__){if(-1!=t.__.parents.indexOf(e))return n.fixChildren(t);if(1==t.__.parents.length)return t.__.parents=[e];r&&n.removeParent(t,r),n.addParent(e)}})},copyMeta:function(e){var r;r=e.constructor==Array?this.createArray(e.length):Object.create(c.Hash);var n=e.__;return t.addNE(r,{__:{notify:n.notify,listener:n.listener,parents:n.parents.slice(0),trans:n.trans,dirty:!1,freezeFn:n.freezeFn}}),r},refreshParents:function(e,t){var r,n=e.__;if(n.listener&&this.trigger(t,"update",t),n.parents.length)for(r=n.parents.length-1;r>=0;r--)0==r?this.refresh(n.parents[r],e,t,!1):this.markDirty(n.parents[r],[e,t]);else n.listener&&n.listener.trigger("immediate",e,t)},markDirty:function(e,t){var r,n=e.__;for(n.dirty=t,n.trans&&this.refresh(e,t[0],t[1]),r=n.parents.length-1;r>=0;r--)this.markDirty(n.parents[r],t)},removeParent:function(e,t){var r=e.__.parents,n=r.indexOf(t);-1!=n&&r.splice(n,1)},addParent:function(e,t){var r=e.__.parents,n=r.indexOf(t);-1==n&&(r[r.length]=t)},trigger:function(e,r,n){var i=e.__.listener,s=i.ticking;i.ticking=n,s||t.nextTick(function(){var e=i.ticking;i.ticking=!1,i.trigger(r,e)})},createListener:function(e){var t=e.__.listener;return t||(t=Object.create(n,{_events:{value:{},writable:!0}}),e.__.listener=t),t},createArray:function(){return[].__proto__?function(e){var t=new Array(e);return t.__proto__=c.List,t}:function(e){var t=new Array(e),r=c.arrayMethods;for(var n in r)t[n]=r[n];return t}}()},u=function(e,r){var n,i=this,s=function(e,t,r){return"listener"==e?f.createListener(t):f.update(e,t,r)},a=function(){};r||(a=function(e){Object.freeze(e)}),n=f.freeze(e,s,a);var o=n.getListener(),c=!1;o.on("immediate",function(e,r){e==n&&(n=r,c||(c=!0,t.nextTick(function(){c=!1,i.trigger("update",n)})))}),t.addNE(this,{get:function(){return n},set:function(e){var t=s("reset",n,e);t.__.listener.trigger("immediate",n,t)}}),t.addNE(this,{getData:this.get,setData:this.set}),this._events=[]};return u.prototype=t.createNonEnumerable({constructor:u},n),u});